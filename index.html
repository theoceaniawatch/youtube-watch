<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>YouTube Live or Latest Stream</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      margin: 0;
      background: #1d1713;
    }
    iframe {
      width: 100vw;
      height: 56.25vw; /* 16:9 */
      max-height: 100vh;
      border: none;
      display: block;
    }
  </style>
</head>
<body>

<div id="player"></div>

<script>
  const API_KEY = "AIzaSyBxkgmY2z3dD_8eE2bj2PhCw5UDEFBeaJc";
  const CHANNEL_ID = "UClld8wYNrW4K--4sHpM2Q8A";

  async function loadVideo() {

    // 1. Check if channel is live
    const liveResponse = await fetch(
      `https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${CHANNEL_ID}&eventType=live&type=video&key=${API_KEY}`
    );
    const liveData = await liveResponse.json();

    if (liveData.items && liveData.items.length > 0) {
      embedVideo(liveData.items[0].id.videoId);
      return;
    }

    // 2. Get recent videos (we will filter to streams only)
    const recentResponse = await fetch(
      `https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${CHANNEL_ID}&order=date&type=video&maxResults=5&key=${API_KEY}`
    );
    const recentData = await recentResponse.json();

    // 3. Check each video to find a stream
    for (const item of recentData.items) {
      const videoId = item.id.videoId;

      const detailsResponse = await fetch(
        `https://www.googleapis.com/youtube/v3/videos?part=liveStreamingDetails&id=${videoId}&key=${API_KEY}`
      );
      const detailsData = await detailsResponse.json();

      if (
        detailsData.items &&
        detailsData.items.length > 0 &&
        detailsData.items[0].liveStreamingDetails
      ) {
        embedVideo(videoId);
        return;
      }
    }

    // 4. If no streams found, show nothing
    document.getElementById("player").innerHTML = "";
  }

  function embedVideo(videoId) {
    document.getElementById("player").innerHTML = `
      <iframe
        src="https://www.youtube.com/embed/${videoId}?rel=0"
        allowfullscreen
      ></iframe>
    `;
  }

  loadVideo();
</script>

</body>
</html>
